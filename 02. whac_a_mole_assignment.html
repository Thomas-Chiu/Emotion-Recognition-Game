<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./animate.css">
    <title>Which Emotion Am I?</title>
    <style>
        body {
            width: 75%;
            margin: 2.5% auto;
            background: url(./Images/Emotion/bg2.png) repeat center left;
            position: relative;
            font-family: Marvel, sans-serif;
            letter-spacing: 2.5px;
            line-height: 2;
            font-family: Marvel, 微軟正黑體;
        }

        #sectionTop {
            width: 30%;
            clear: both;
            font-size: 2rem;
            position: absolute;
            top: 2.5%;
            right: -12.5%;
        }

        #sectionBottom {
            width: 30%;
            clear: both;
            font-size: 2rem;
            position: absolute;
            bottom: 2.5%;
            right: -12.5%;
        }

        #emotion {
            width: 75%;
            cursor: url(./Images/Cursors/tap.png) 50 50, auto;
            border-radius: 10px;
        }

        #emotion tr td {
            width: 200px;
            height: 200px;
            /* 隱藏溢出td 的動畫效果 */
            overflow: hidden;
            border: 2.5px solid #ccc;
            background: lightcyan;
            position: relative;
            border-radius: 10px;
        }

        #txtEmotionUp {
            width: 75%;
            color: olive;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            line-height: 2.5;
            border: 2.5px solid #ccc;
            background: lightcyan;
            margin-bottom: 0.5%;
            border-radius: 10px;
        }

        #txtEmotionDown {
            width: 75%;
            color: olive;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            line-height: 2.5;
            border: 2.5px solid #ccc;
            background: lightcyan;
            margin-top: 0.5%;
            border-radius: 10px;
        }

        #btnPicker {
            position: absolute;
            bottom: 15%;
            left: 2.5%;
        }

        #btnStart {
            position: absolute;
            bottom: 9%;
            right: 34%;
        }

        #btnPicker:hover {
            cursor: pointer;
        }

        #btnStart:hover {
            cursor: pointer;
        }

        .finger {
            width: 75px;
        }

        .borderRight {
            border-right: 5px dotted #ccc;
            border-radius: 5%;
        }

        .gold {
            background: gold;
        }

        .hole {
            width: 100%;
            height: 100%;
            display: none;
        }

        .txtClickMe {
            font-size: 1rem;
            background-color: darkgray;
            color: #fff;
            border-radius: 5px;
            font-weight: bold;
            padding: 0 3px;
            display: inline-block;
            margin: 50% 17.5% 0 5%;
        }


        /* 快樂 */
        #amusement {
            background: url(./Images/Emotion/amusement.png) no-repeat center center/cover;
        }

        /* 生氣 */
        #anger {
            background: url(./Images/Emotion/anger.png) no-repeat center center/cover;
        }

        /* 害羞 */
        #embarrassment {
            background: url(./Images/Emotion/embarrassment.png) no-repeat center center/cover;
        }

        /* 害怕 */
        #fear {
            background: url(./Images/Emotion/fear.png) no-repeat center center/cover;
        }

        /* 喜悅 */
        #happiness {
            background: url(./Images/Emotion/happiness.png) no-repeat center center/cover;
        }

        /* 痛苦 */
        #pain {
            background: url(./Images/Emotion/pain_2.png) no-repeat center center/cover;
        }

        /* 難過 */
        #sadness {
            background: url(./Images/Emotion/sadness.png) no-repeat center center/cover;
        }

        /* 羞愧 */
        #shame {
            background: url(./Images/Emotion/shame.png) no-repeat center center/cover;
        }

        /* 憤怒 */
        #furious {
            background: url(./Images/Emotion/furious.png) no-repeat center center/cover;
        }

        /* 興奮 */
        #excited {
            background: url(./Images/Emotion/excited.png) no-repeat center center/cover;
        }

        /* 噁心 */
        #disgust {
            background: url(./Images/Emotion/disgust.png) no-repeat center center/cover;
        }

        /* 驚訝 */
        #surprise {
            background: url(./Images/Emotion/surprise.png) no-repeat center center/cover;
        }
    </style>
</head>

<body>
    <table id="txtEmotionUp">
        <tr>
            <td class="borderRight emid">興奮</td>
            <td class="borderRight emid">生氣</td>
            <td class="borderRight emid">噁心</td>
            <td class="borderRight emid">喜悅</td>
            <td class="borderRight emid">害羞</td>
            <td class="emid">快樂</td>
        </tr>
    </table>
    <table id="emotion">
        <tr>
            <td id="hole9">
                <div class="hole animated slideInUp" id="amusement"></div>
            </td>
            <td id="hole10">
                <div class="hole animated slideInUp" id="anger"></div>
            </td>
            <td id="hole11">
                <div class="hole animated slideInUp" id="embarrassment"></div>
            </td>
            <td id="hole12">
                <div class="hole animated slideInUp" id="fear"></div>
            </td>
        </tr>
        <tr>
            <td id="hole5">
                <div class="hole animated slideInUp" id="happiness"></div>
            </td>
            <td id="hole6">
                <div class="hole animated slideInUp" id="pain"></div>
            </td>
            <td id="hole7">
                <div class="hole animated slideInUp" id="sadness"></div>
            </td>
            <td id="hole8">
                <div class="hole animated slideInUp" id="shame"></div>
            </td>
        </tr>
        <tr>
            <td id="hole1">
                <div class="hole animated slideInUp" id="furious"></div>
            </td>
            <td id="hole2">
                <div class="hole animated slideInUp" id="excited"></div>
            </td>
            <td id="hole3">
                <div class="hole animated slideInUp" id="disgust"></div>
            </td>
            <td id="hole4">
                <div class="hole animated slideInUp" id="surprise"></div>
            </td>
        </tr>
    </table>
    <table id="txtEmotionDown">
        <tr>
            <td class="borderRight emid">害怕</td>
            <td class="borderRight emid">羞愧</td>
            <td class="borderRight emid">憤怒</td>
            <td class="borderRight emid">難過</td>
            <td class="borderRight emid">驚訝</td>
            <td class="emid">痛苦</td>
        </tr>
    </table>
    <section id="sectionTop">
        SCORE: <span id="txtScore">0</span><br>
        TIME LEFT: <span id="txtTime">0</span><br>
        <hr>
        <div>
            <img id="btnPicker" src="./Images/pinwheel.svg" alt="pinwheel" title="點我選情緒">
            <img id="btnStart" class="animated infinite pulse fast" src=" ./Images/start_button.svg" alt="start button"
                title="點我玩遊戲">
        </div>
        <div>
            <span class="txtClickMe">選情緒</span>
            <span class="txtClickMe">玩遊戲</span>
        </div>
    </section>
    <section id="sectionBottom">
        <br><strong>RANKING</strong>
        <hr>
        TOP PLAYER: <span id="txtTopPlayer"></span><br>
        HIGHEST SCORE: <span id="txtHighScore">0</span><br>
    </section>

    <script>
        const holes = document.getElementsByClassName(`hole`)
        const btnStart = document.getElementById(`btnStart`)
        const txtTime = document.getElementById(`txtTime`)
        const txtScore = document.getElementById(`txtScore`)
        const txtTopPlayer = document.getElementById(`txtTopPlayer`)
        const txtHighScore = document.getElementById(`txtHighScore`)
        const btnPicker = document.getElementById(`btnPicker`)
        const emid = document.getElementsByClassName(`emid`)
        const audio = new Audio()
        audio.src = `./Audio/yay.mp3`
        // 控制.happiness 裡面的內容
        // const happiness = document.querySelector(`.happiness`)
        const rand = function (num) {
            return Math.floor(Math.random() * num)
        }

        let score = 0
        let inGame = false
        let timeLeft = 0
        let timer = 0
        let highScore = { name: ``, score: 0 }
        // 這行看不懂
        let storage = JSON.parse(localStorage.getItem(`highScore`))
        if (storage != null) {
            highScore.name = storage.name
            highScore.score = storage.score
            txtTopPlayer.innerHTML = highScore.name
            txtHighScore.innerHTML = highScore.score
        }


        // 抽表情執行
        const click = btnPicker.onclick = function () {
            btnPicker.disabled = true
            let timer = setInterval(pick, 350)
            pick()
            // 5秒後結束抽表情
            setTimeout(function () {
                clearInterval(timer)
                btnPicker.disabled = false
            }, 5000);
        }


        // 抽表情函數
        const pick = function () {
            for (let e of emid) {
                e.classList.remove(`gold`)
            }
            emid[rand(emid.length)].classList.add(`gold`)
        }


        // 遊戲執行
        btnStart.onclick = () => {
            // 延遲待處理
            setTimeout(function () {
                btnStart.disabled = true
                inGame = true
                timer = setInterval(game, 2000)
                game()
                score = 0
                timeLeft = 5
                txtTime.innerHTML = timeLeft
            }, 100)
        }

        // 遊戲函數
        const game = () => {
            // 清除所有格子的屬性
            for (let i = 0; i < holes.length; i++) {
                holes[i].classList.remove(`animated`, `rubberBand`)
                holes[i].classList.add(`animated`, `slideInUp`)
                holes[i].style.display = `none`
            }

            for (let i = 0; i < 4; i++) {
                holes[rand(holes.length)].style.display = `block`
                console.log(rand(holes.length))
            }
            for (let hole of holes) {
                hole.onclick = () => {
                    /* 其實這裡不用if 也可以跑
                    if (inGame && hole.style.display == `block`) {
                        or
                    if (inGame && hole.classList.contains(`animated`, `slideInUp`)) {
                     }
                    */
                    hole.classList.remove(`animated`, `slideInUp`)
                    hole.classList.add(`animated`, `rubberBand`)
                    score++
                    txtScore.innerHTML = score
                }
            }

            timeLeft--
            txtTime.innerHTML = timeLeft

            if (timeLeft == 0) {
                inGame = false
                clearInterval(timer)
                for (let hole of holes) {
                    hole.style.display = `none`
                }
                btnStart.disabled = false
                setTimeout(function () {
                    alert(`You score: ${score}`)
                }, 100)

                if (storage == null || score > highScore.score) {
                    audio.play()
                    const input = prompt(`Congrats, you're the Top! Insert your name.`)
                    if (input != null && input.trim() != ``) {
                        highScore.name = input
                        highScore.score = score
                        txtTopPlayer.innerHTML = highScore.name
                        txtHighScore.innerHTML = highScore.score
                        // 這邊看不懂
                        localStorage.setItem(`highScore`, JSON.stringify(highScore))
                    }
                }
            }
        }
    </script>
</body>

</html>